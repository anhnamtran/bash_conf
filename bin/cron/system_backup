#!/usr/bin/bash
ROOT="/"
BACKUP_DIR="/run/media/andrew_nt/AndrewTran/Backups/DahliaEndeavor/"

if ! [ -d "$BACKUP_DIR" ]; then
  echo "$BACKUP_DIR not found or not mounted, unable to backup system"
  exit 1
fi
if ! type rsync > /dev/null 2>&1; then
  echo "No rsync found, unable to backup system"
  exit 1
fi

echo "Backing up system... "
sudo rsync -aAXHS \
  --info=progress2,stats2 \
  --delete \
  --exclude-from="/home/andrew_nt/bin/cron/system_backup_exclude.txt" \
  "$ROOT" "$BACKUP_DIR" 2>&1 | sudo tee /home/andrew_nt/bin/cron/system_backup.log

if [ "$?" -ne 0 ]; then
  echo "rsync failed, check cron logs"
  exit 1
fi
echo "Successfully backed up system to $BACKUP_DIR"
