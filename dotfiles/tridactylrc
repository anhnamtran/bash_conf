" General settings
set smoothscroll true
set theme dark
set hintfiltermode vimperator-reflow
set hintnames numeric
set incsearch true
set wordpattern [^\s\/]+
set escapehatchsidebarhack false
set followpagepatterns.next ^(next|newer)\b|»|>>|more|>
set followpagepatterns.prev ^(prev(ious)?|older)\b|«|<<|<

" i to go to ignore mode
" Ctrl+Enter to leave ignore mode
command ignore mode ignore
bind --mode=ignore <C-Enter> mode normal
bind i mode ignore

" Faster scrolling
bind j scrollline 5
bind k scrollline -5

" Tab operations
bind L tabnext
bind H tabprev
bind yt tabduplicate
bind ;t tabdetach
bind ;T composite tabduplicate; tabdetach

alias tg tabgrab
alias tabc tabclose
alias tabm tabmove

command tabpush_and_focus jsb void async function(){const tabId=await activeTabId();fillcmdline("tabpush");while(true){if(tabId==await activeTabId())await sleep(50);else break}browser.tabs.update(tabId,{active:true});const tabNow=await browser.tabs.get(tabId);browser.windows.update(tabNow.windowId,{focused:true})}();

alias tp tabpush_and_focus

" tridactyl search
set findcase smart
bind / fillcmdline find
bind ? fillcmdline find --reverse
bind n findnext --search-from-view
bind N findnext --search-from-view --reverse
bind gn findselect
bind gN composite findnext --search-from-view --reverse; findselect
bind ,<Space> nohlsearch

" general browsing
bind <C-]> forward
bind <C-[> back

" Have ZZ correctly restore multiple windows
bind ZZ !s killall firefox

unbind --mode=normal <C-b>
bind --mode=browser <C-b> tab #

bind --mode=ex <C-w> text.backward_kill_word
bind --mode=input <C-w> text.backward_kill_word
bind --mode=insert <C-w> text.backward_kill_word

bind --mode=normal <AC-,> escapehatch
bind --mode=browser <AC-,> escapehatch

" Only hint search results on Google and DDG
bindurl www.google.com f hint -Jc #search div:not(.action-menu) > a
bindurl www.google.com F hint -Jbc #search div:not(.action-menu) > a
bindurl ^https://duckduckgo.com f hint -Jc [data-testid="result-title-a"]
bindurl ^https://duckduckgo.com F hint -Jbc [data-testid="result-title-a"]

" Kagi search bindings
bindurl ^https://kagi.com / focusinput -b
bindurl ^https://kagi.com f hint -Jc a[class$="_0_URL"]
bindurl ^https://kagi.com F hint -Jbc a[class$="_0_URL"]
bindurl ^https://kagi.com S hint -Jc [class="_0_summarize_link"] > a

unbind <Space>

" use tabs to change hints
set hintmaps.<Tab> hint.focusNextHint
set hintmaps.<S-Tab> hint.focusPreviousHint

autocmd TabEnter .* unfocus

" Google Calendar bindings
bindurl calendar.google.com/calendar/* e hint -Jc div[class="hnGhZ"] div[role="button"]
bindurl calendar.google.com/calendar/* A hint -Jc div[class^="jefcFd"]  button, div[class^="jefcFd"] a, div[class^="jefcFd"]  div[role="button"]
" Select the event element to scroll when entering the tab
autocmd TabEnter ^https://calendar.google.com/calendar/* hint -;Jc [class="hnGhZ"][role="presentation"]

" Enter ignore mode on the following pages
seturl .*\.coderpad\.io\/.* superignore true

" Arista domains
set searchurls.go https://go/%s
set searchurls.pb https://pb/%s
set searchurls.aid https://aid/%s
set searchurls.dashboard https://dashboard/%s
set searchurls.bug https://bug/%s
set searchurls.bb https://bb/%s
set searchurls.cl https://cl/%s
set searchurls.review https://reviewboard/%s
set searchurls.aboard https://aboard/react/user/andrew_nt/%s
set searchurls.src https://src/%s
set searchurls.grok https://opengrok/source/search?project=eos-trunk&full=%s
set searchurls.eosdoc https://eosdoc2.infra.corp.arista.io/#/%s
set searchurls.crontab https://crontab.guru/#%s

" reviewboard bindings
bindurl reviewboard.*/r/[0-9]+ f hint
bindurl reviewboard.*/r/[0-9]+ R hint -Jc li[class^="review-request-action"] > a[href*="/r/"]
bindurl reviewboard.*/r/[0-9]+ F hint -Jc input
bindurl reviewboard.*/r/[0-9]+ D hint -Jc a[href*="/diff/"]
bindurl reviewboard.*/r/[0-9]+ S hint -Jc a[id="ship-it-action"]
bindurl reviewboard.*/r/[0-9]+ l hint -Jc tbody[id^="chunk"] > tr[line] > th
bindurl reviewboard.*/dashboard F hint -Jbc a[class="review-request-link"]
bindurl reviewboard.*/users F hint -Jbc a[class="review-request-link"]
seturl reviewboard.*/ followpagepatterns.next ^(next|newer)\b|more|>
seturl reviewboard.*/ followpagepatterns.prev ^(prev(ious)?|older)\b|<

" bugsby bindings
bindurl bb.*/ D hint -;Jc .ant-modal-wrap:not([style="display: none;"]) [class^=detail-content-]
" select the table content to scroll
autocmd TabEnter ^https://bb.*/ hint -;Jc .ant-table-body

" Areview bindings
bindurl eng3.aristanetworks.com/areview A hint -Jc .rank-table-row-users
bindurl eng3.aristanetworks.com/areview c hint -Jc .comment-user
bindurl eng3.aristanetworks.com/areview F hint -;Jc .rank-comment-panel > div

" vim: ft=vim
